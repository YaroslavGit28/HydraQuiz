# ФУНКЦИИ приложения "HydraQuiz"

## 1. Основные функции для пользователя

- **Выбор группы и темы викторины**
  - Пользователь может выбрать интересующую группу (например, "Авто", "Игры", "Вещи") и тему внутри группы.

- **Ввод имени игрока**
  - Перед началом викторины требуется ввести имя, чтобы результаты сохранялись индивидуально.

- **Прохождение викторины**
  - Вопросы с несколькими вариантами ответов.
  - Возможность выбрать только один вариант.
  - Переход к следующему вопросу после ответа.

- **Подсчет и отображение результатов**
  - После завершения викторины показывается количество правильных ответов, процент и общее количество вопросов.

- **Сохранение результатов**
  - Результаты каждой попытки сохраняются в локальную базу данных SQLite.

- **Просмотр истории попыток**
  - Можно открыть историю своих попыток по имени игрока.
  - В истории отображаются тема, счет, процент, дата.

- **Просмотр таблицы лидеров**
  - Отдельная форма показывает топ-10 пользователей с наивысшим средним процентом правильных ответов.

- **Разбор ответов (Review)**
  - После завершения викторины можно просмотреть свои ответы, правильные ответы и узнать, где были ошибки.

- **Переключение темы оформления**
  - Поддерживаются светлая и темная темы для всего интерфейса.
  - Переключение темы происходит мгновенно.

- **Выход из викторины и возврат к выбору**
  - Можно выйти из текущей викторины и начать новую.

## 2. Работа с данными

- **Загрузка вопросов**
  - Вопросы загружаются из файла `questions.json` при запуске приложения.
  - Поддерживается структура: текст вопроса, варианты, правильный ответ, категория, группа.

- **Сохранение и загрузка результатов**
  - Результаты сохраняются в SQLite (`quiz_results.db`).
  - Для тестов и резервного копирования поддерживается также сохранение в JSON.

- **Получение лучших результатов**
  - Сервис позволяет получить лучший результат пользователя и топ-лидеров по среднему проценту.

- **Удаление истории пользователя**
  - Можно удалить все результаты конкретного пользователя из базы данных.

## 3. Интерфейс и взаимодействие

- **Главная форма**
  - Управляет навигацией между панелями: старт, викторина, результаты.
  - Обрабатывает все основные события (старт, следующий вопрос, завершение, просмотр истории и лидеров).

- **Форма истории (HistoryForm)**
  - Показывает таблицу всех попыток выбранного игрока.

- **Форма лидеров (LeadersForm)**
  - Показывает таблицу топ-10 пользователей.

- **Форма разбора (ReviewForm)**
  - Показывает таблицу: вопрос, ваш ответ, правильный ответ, результат (✔/✘).

## 4. Темы оформления

- **ThemeManager**
  - Управляет текущей темой (светлая/темная).
  - Применяет цвета ко всем элементам интерфейса.

- **ThemeColors**
  - Описывает цветовые схемы для разных элементов (фон, текст, кнопки, таблицы).

## 5. Тестирование

- **Модульные тесты**
  - Проверяют корректность загрузки/сохранения вопросов и результатов.
  - Проверяют работу с базой данных (добавление, получение, удаление результатов).
  - Используют временные файлы и отдельную БД для изоляции.

## 6. Дополнительные функции и детали

- **Анимация появления вопросов**
  - Вопросы и варианты плавно появляются при переходе к новому вопросу.

- **Проверка корректности ввода**
  - Если не введено имя или не выбран ответ — показывается предупреждение.

- **Локализация**
  - Все сообщения и интерфейс на русском языке.

- **Обработка ошибок**
  - Все операции с файлами и БД защищены от сбоев, ошибки выводятся пользователю.

## 7. Перечень основных функций (методов) приложения с объяснениями

### Главная форма (Form1)
- **Form1()** — конструктор формы, инициализирует компоненты и подписывает события.
- **Form1_Load(object? sender, EventArgs e)** — обработчик загрузки формы, загружает вопросы, применяет тему, настраивает интерфейс.
- **GroupComboBox_SelectedIndexChanged(object? sender, EventArgs e)** — обновляет список тем при смене выбранной группы.
- **StartButton_Click(object? sender, EventArgs e)** — начинает новую викторину, формирует список вопросов по выбранной теме и группе.
- **NextButton_Click(object? sender, EventArgs e)** — обрабатывает выбор ответа и переход к следующему вопросу.
- **RestartButton_Click(object? sender, EventArgs e)** — сбрасывает состояние и возвращает к стартовой панели.
- **ThemeSwitchCheckBox_CheckedChanged(object? sender, EventArgs e)** — переключает светлую/темную тему оформления.
- **LeadersButton_Click(object? sender, EventArgs e)** — открывает окно с таблицей лидеров.
- **DisplayQuestion(CancellationToken token)** — отображает текущий вопрос и варианты ответов, анимирует появление.
- **ShowResults()** — подсчитывает и отображает результат викторины, сохраняет его в базу данных.
- **HistoryButton_Click(object? sender, EventArgs e)** — открывает окно истории попыток текущего игрока.
- **StatsButton_Click(object? sender, EventArgs e)** — показывает статистику по всем попыткам игрока.
- **ExitQuizButton_Click(object? sender, EventArgs e)** — завершает текущую викторину и возвращает к выбору темы.
- **ReviewButton_Click(object? sender, EventArgs e)** — открывает окно разбора ответов (правильные/неправильные).
- **ShowPanel(Panel panelToShow)** — управляет видимостью основных панелей интерфейса.

### Сервис работы с вопросами (QuizDataService)
- **LoadQuestions()** — загружает список вопросов из файла questions.json.
- **SaveQuestions(List<Question> questions)** — сохраняет список вопросов в файл questions.json.
- **LoadResults()** — загружает результаты попыток из файла results.json (альтернативное хранение).
- **SaveResults(List<QuizResult> results)** — сохраняет результаты попыток в файл results.json.

### Сервис работы с результатами (QuizResultsDbService)
- **QuizResultsDbService(string dbFileName = "quiz_results.db")** — конструктор, инициализирует подключение к базе данных SQLite.
- **AddResult(QuizResultDbModel result)** — добавляет новый результат в базу данных.
- **GetBestResults()** — возвращает лучшие результаты пользователей (для лидерборда).
- **GetUserHistory(string userName)** — возвращает историю всех попыток конкретного пользователя.
- **GetTopLeaders(int top = 5)** — возвращает топ-N пользователей с наивысшим средним процентом.
- **DeleteUserResults(string userName)** — удаляет все результаты выбранного пользователя из базы данных.

### Темы оформления (ThemeManager)
- **ToggleTheme()** — переключает текущую тему между светлой и темной.
- **ApplyTheme(Form form)** — применяет текущую тему ко всем элементам формы.

### Форма истории (HistoryForm)
- **HistoryForm(string playerName)** — конструктор, принимает имя игрока для отображения истории.
- **HistoryForm_Load(object? sender, EventArgs e)** — загружает и отображает историю попыток игрока.

### Форма лидеров (LeadersForm)
- **LeadersForm()** — конструктор формы лидеров.
- **LeadersForm_Load(object? sender, EventArgs e)** — загружает и отображает таблицу лидеров.

### Форма разбора (ReviewForm)
- **ReviewForm(List<Question> questions, List<int> userAnswers)** — конструктор, формирует таблицу с вашими и правильными ответами.

### Программа (Program)
- **Main()** — точка входа приложения, запускает главную форму.

### Модульные тесты (QuizServicesTests)
- **Setup()** — подготавливает временные файлы и окружение для тестов.
- **Cleanup()** — удаляет временные файлы после тестов.
- **SaveAndLoadQuestions_WorksCorrectly()** — тестирует корректность сохранения и загрузки вопросов.
- **SaveAndLoadResults_WorksCorrectly()** — тестирует корректность сохранения и загрузки результатов.
- **AddAndGetResults_FromDb_WorksCorrectly()** — тестирует добавление и получение результатов из базы данных.
- **DeleteUserResults_RemovesData()** — тестирует удаление результатов пользователя из базы данных.

---

Каждая из этих функций реализует отдельную часть логики приложения: загрузка и отображение вопросов, обработка ответов, сохранение и анализ результатов, оформление, тестирование и т.д.

**HydraQuiz** — это современное, удобное и надежное приложение для проведения викторин с сохранением и анализом результатов, поддержкой тем и тестированием. 